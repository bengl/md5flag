<!doctype html>

<html>
  <head>
    <title>MD5 Flag</title>
    <script src="https://raw.github.com/blueimp/JavaScript-MD5/master/md5.min.js"></script>
  </head>
  <body>
    <h1>MD5 Flag</h1>
    <p>This is "free speech flag" generator for arbitrary MD5 hashes of text. The input is any text you like, and the output is a png in the style of the <a href="http://www.badmouth.net/free-speech-flag/">free speech flag</a> based on the MD5 hash of the input text.
    <div>
      <textarea rows="20" cols="80" id="input">Paste some text here to get the md5 flag of the text.</textarea>
    </div>
    <a href="#" id="flagbutton">Make a flag!</a>
    <div id="hashresult"></div>
    <canvas id="md5flag" width="800" height="450" style="display:none"></canvas>
    <script>

function contrasting(color){
  return parseInt('0x'+color)*2 > 0xffffff ? "#000000" : "#ffffff";
}

function $(id){ return document.getElementById(id); }

$('flagbutton').onclick = function(){
var canvas = $('md5flag'),
    ctx = canvas.getContext('2d'),
    hash = md5($('input').value),
    colors = hash.match(/.{1,6}/g);
  
  $('hashresult').innerHTML = "MD5 Hash: "+hash;
  var currentFlag = $('pngflag');
  if (currentFlag) 
    document.body.removeChild(currentFlag);
  
  for (var i = 0; i < 5; i++) {
    ctx.fillStyle = "#"+colors[i];
    ctx.fillRect(i*160,0,160,450);
  }
  ctx.font = '60px "Courier New"';
  ctx.lineWidth = 1;
  ctx.fillStyle = parseInt(colors[4],16)*2 > 16777215 ? "#000000" : "#ffffff";
  ctx.fillText('+'+colors[5].toUpperCase(), 690, 440);

  var img = document.createElement('img');
  img.setAttribute('src',canvas.toDataURL('image/png'));
  img.setAttribute('id','pngflag');
  document.body.appendChild(img);
};

    </script>
  </body>
</html>
